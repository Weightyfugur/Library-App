@page "/book/create"
@inject LibraryDBContext connection
@inject NavigationManager nav

<div class="container" style="text-align:center;">
    <h3>Book Creation Form</h3><br/>

    <!-- Form to create new book (does not check for pre-existing book atm) -->
    <EditForm Model=@newBook OnValidSubmit="@FormSubmitted">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="form-group row">
            <div class="col"></div>
            <div class="col">
                <label for="Title">Book Title </label>
            </div>
            <div class="col">
                <InputText id="Title" @bind-Value="@newBook.Title" />
            </div>
            <div class="col"></div>
        </div>

        <div class="form-group row">
            <div class="col"></div>
            <div class="col">
                <label for="Author">Book Author </label>
            </div>
            <div class="col">
                <InputText id="Author" @bind-Value="@newBook.Author" />
            </div>
            <div class="col"></div>
        </div>

        <div class="form-group row">
            <div class="col"></div>
            <div class="col">
                <label for="ISBN">Book ISBN </label>
            </div>
            <div class="col">
                <InputText id="ISBN" @bind-Value="@newBook.ISBN" />
            </div>
            <div class="col"></div>
        </div>

        <div class="form-group row">
            <div class="col"></div>
            <div class="col">
                <label for="Status">Book Status</label>
            </div>
            <div class="col">
                <InputSelect @bind-Value="@newBook.Status">
                    <option value="Coming Soon">Coming Soon</option>
                    <option value="Available">Available</option>
                    <option value="Checked Out">Checked Out</option>
                </InputSelect>
            </div>
            <div class="col"></div>
        </div>

        <div class="form-group row">
            <div class="col"></div>
            <div class="col">
                <label for="ISBN">Number of Book Copies </label>
            </div>
            <div class="col">
                <InputNumber id="NumCopies" min="1" @bind-Value="@newBook.NumCopies" />
            </div>
            <div class="col"></div>
        </div>

        <input type="submit" value="Create Book" class="btn btn-primary" />
    </EditForm>
</div>

@code {
    public Book newBook = new Book();
    string Status;

    void FormSubmitted() {

        // Makes a connection to the database and adds a new book, saves changes
        // Optional usage instead of States -> connection.Books.Add(newBook);
        connection.Entry(newBook).State = Microsoft.EntityFrameworkCore.EntityState.Added;
        connection.SaveChanges();

        nav.NavigateTo(nav.Uri, forceLoad:true);

    }
}
